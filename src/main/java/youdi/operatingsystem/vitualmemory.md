### 内存虚拟化计算

1. 安全角度，内存需要隔离



### 一个程序最多可以使用多少内存？


虚化内存：
为了解决不够用的


### Sawp技术

地址空间
是一块连续的内存块


碎片问题：
进程来回分配， 回收交换， 内存之间会产生很多缝隙

频繁切换问题：
    如果进程过多，内存较小，会频繁触发交换



设计目标：
    
    隔离：每个应用有自己的地址空间，互不影响、
    性能： 高频使用的数据保留在内存中，低频使用的数据持久化到磁盘中
    程序好写： 不用关心底层设施



### 虚拟化内存

    应用 -> 页(虚拟内存) -> 真实内存

每个应用都有高频使用的数据和低频使用的数据
按页进行缓存



虚拟内存
    页 -> 页表 -> frame

1. 通过虚拟地址计算page编号
2. 查页表，根据page编号，找到Frame编号
3. 将虚拟地址算成物理地址




### MMU 
    Memory Management Unit， MMU
    虚拟内存 -> MMU ->（物理地址，地址总线） 真实地址

高速缓存

### 页表条目
    
    absent 在
    protection 保护
    reference 访问
    dirty   脏
    caching 缓存
    frame number

二级页表
    
    


一个程序最多可以使用多少内存？
2^64
1EB=10


### 什么情况下使用大页内存？


### 内存管理单元MMU

MMU

1. 虚拟地址到物理地址映射转换
2. 操作内存地址

mmu是cpu和内存之间的代理


### TLB
TLB和MMU的性能问题

在MMU中往往还有一个微型的设备
转置检测缓冲区(TLB)

TLB(快表)
page numger => Frame number 

缓存条目

硬件实现


TLB失效(Miss)

LRU

软失效： Frame还在内存中，只是TLB缓存中没有，具体选择哪个条目进行覆盖，称为  缓存置换



硬失效：
Frame没在内存中，需要从硬盘加载

注意： 线程不可能从休眠态不排队进入执行态， 硬失效是相对耗时的。 



### TLB缓存的设计
    基于缓存行(cache line)的缓存有3种映射方案

1. 全相联映射  一个数据可能在任何条目中
2. 直接映射    类似哈希函数  
3. n路组相联映射  一个数据只能在一部分缓存条目中出现  hash 数组开链法


### 大内存分页
    操作系统： 提供大内存分页






### 什么情况下使用大内存分页？
1. 通常在应用对内存需求较大时，比如一个搜索引擎需要大量在内存中的索引，这个时候可以考虑开启
2. 当高并发来的时候，对内存的需求高的，考虑开启




